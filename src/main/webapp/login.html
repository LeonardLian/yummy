<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>欢迎使用yummy</title>
</head>
<body>
<div>
    <button id="userView" onclick="userView()">用户登录</button>
    <button id="restView" onclick="restView()">餐厅登录</button>
</div>
<div id="user" style="display: block">
    <div>
        <p>用户登录</p>
    </div>
    <div>
        <input id="username" placeholder="邮箱" type="text" >
    </div>
    <div>
        <input id="userCode" placeholder="验证码" type="text">
        <button id="codeGet" onclick="sendEmail()">获取验证码</button>
    </div>
    <div>
        <button onclick="userLogin()">登录</button>
    </div>
</div>
<div id="rest" style="display: none">
    <div>
        <p>餐厅登录</p>
    </div>
    <div>
        <input id="restCode" placeholder="注册码" type="text" >
    </div>
    <div>
        <input id="password" placeholder="密码" type="password">
    </div>
    <div>
        <button id="register" onclick="">注册</button>
        <button id="restLogin" onclick="restaurantLogin()">登录</button>
    </div>
</div>
<div>

</div>
</body>
<script src="https://cdn.bootcss.com/jquery/3.3.1/jquery.min.js"></script>
<script src="get_cookies.js"></script>
<!--<script src="test.js"></script>-->
<script>
    function userView() {
        document.getElementById("user").style.display='block';
        document.getElementById("rest").style.display='none';
    }

    function restView() {
        document.getElementById('user').style.display='none';
        document.getElementById('rest').style.display='block';
    }
    
    function sendEmail() {
        var email=$('#username').val();
        var emailOb=new EmailOb(email);
        //var emailJson=JSON.stringify(emailOb);

        $.ajax({
            type:'post',
            dataType:'text',
            url:'EmailServlet',
            data:emailOb,
            success: function(msg){
                //alert(msg.foodid);
                document.cookie="code="+msg;
                document.cookie="email="+email;
                alert("验证码已发送");
            },
            error:function (error) {
                alert(error);
            }
        });
    }

    function userLogin() {
        var emailcode=getcookie('code');
        var userEmail=getcookie('email');
        //var emailcode=getcookie('code');

        var inputEmail=$('#username').val();
        var inputCode=$('#userCode').val();

        if((userEmail==inputEmail)&&(emailcode==inputCode)){
            window.location.href='/userMainpage.html';
        }
        else {
            alert("邮箱或密码错误")
        }
    }

    function restaurantLogin() {
        var restCode=$('#restCode').val();
        var password=$('#password').val();
        var restaurant=new Restaurant(restCode,password);

        $.ajax({
            type:'post',
            dataType:'text',
            url:'SignInRestaurantServlet',
            data:restaurant,
            success:function (msg) {
                if(msg==0){
                    alert("您的餐厅仍在审核")
                }
                else if(msg==2){
                    alert("您的餐厅审核未通过！")
                }
                else if(msg==3){
                    alert("账户或密码错误")
                }
                else if(msg==1){
                    document.cookie='restcode='+restCode;
                    window.location.href='/restMainpage.html';
                }
            }
        })
    }


    function EmailOb(email) {
        this.email=email;
    }

    function Restaurant(code,password) {
        this.code=code;
        this.password=password;
    }
</script>
</html>